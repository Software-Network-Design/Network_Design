## Protocal & Database

#### 消息格式

`(发送用户;接收用户;类型;消息内容)`

##### 类型

| 类型号 | 代表消息       |
| ------ | -------------- |
| 1      | 登录消息       |
| 2      | 服务器响应登录 |
| 3      | 一对一消息     |
| 4      | 群发消息       |

##### 用户

* 每个用户拥有一个号码（类似QQ号，'U' + 数字串）
* 每个群拥有一个群号（'G' + 数字串）



#### 登录过程

```
Client-->Server
(发送用户(用户Num);接受用户();类型(1);消息内容(用户Num,密码))
Server-->Client
(发送用户();接受用户(用户Num);类型(2);消息内容(用户拥有的好友与群聊))
```



#### 聊天过程

##### 一对一聊天

```
Client-->Server
(发送用户(用户Num);接受用户(用户Num);类型(3);消息内容(聊天消息))
Server-->Client
(发送用户(用户Num);接受用户(用户Num);类型(3);消息内容(聊天消息))
```

##### 群聊

```
Client-->Server
(发送用户(用户Num);接受用户(群Num);类型(4);消息内容(聊天消息))
Server-->Client
(发送用户(群Num);接受用户(用户Num);类型(4);消息内容(聊天消息))
```



### 数据库

##### E-R图

![聊天软件数据库.drawio](.\media\聊天软件数据库.drawio.png)

User

| 属性     | 类型    | 主键 | 外键 |
| -------- | ------- | ---- | ---- |
| 用户Num  | VARCHAR | √    | √    |
| 用户昵称 | VARCHAR |      |      |

Group

| 属性  | 类型    | 主键 | 外键 |
| ----- | ------- | ---- | ---- |
| 群Num | VARCHAR | √    | √    |

User_Friends

| 属性     | 类型    | 主键 | 外键 |
| -------- | ------- | ---- | ---- |
| 用户1Num | VARCHAR | √    | √    |
| 用户2Num | VARCHAR | √    | √    |

User_Group

| 属性    | 类型    | 主键 | 外键 |
| ------- | ------- | ---- | ---- |
| 群Num   | VARCHAR | √    | √    |
| 用户Num | VARCHAR | √    | √    |